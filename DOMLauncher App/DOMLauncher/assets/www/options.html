<!DOCTYPE html>

<html>
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        
        <title>CHome</title>
        
        <script type="text/javascript" src="cordova-2.1.0.js"></script>  
        <script type="text/javascript" src="js/launch.js"></script>  
        <script type="text/javascript" src="js/test.js"></script>  
        <script type="text/javascript" src="js/airplane.js"></script>  
        <script type="text/javascript" src="js/applist.js"></script>  
        <script type="text/javascript" src="js/fullscreentoggle.js"></script>  
        <script type="text/javascript" src="js/wifitoggler.js"></script>  
        <script type="text/javascript" src="js/wifisignalgetter.js"></script>  
        <script type="text/javascript" src="js/volumecontrols.js"></script>  
        <script type="text/javascript" src="js/cellularsignalgetter.js"></script>  
        <script type="text/javascript" src="js/mobiledatatoggler.js"></script>  
        <script type="text/javascript" src="js/simplesave.js"></script>  
        <script type="text/javascript" src="js/missedcommunications.js"></script>  
		
		<script src="js/jquery-1.8.1.min.js"></script>
        <!--<script src="js/jquery-ui-1.8.23.custom.min.js"></script>-->        
		<script src="js/functions.js"></script>
        <script>
        
			function onLoad() {document.addEventListener("deviceready", deviceReady, false);}
			
			function deviceReady() { 
				window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onRequestFileSystemSuccess, null);
				function onRequestFileSystemSuccess(fileSystem) { 
					var findDirectory=fileSystem.root; 
					findDirectory.getFile("/data/data/com.awaa.domlauncher/settings.xml", {create:true, exclusive: true}, onGetDirectorySuccess, onGetDirectoryFail); 
					findDirectory.getFile("/data/data/com.awaa.domlauncher/quickcontacts.xml", {create:true, exclusive: true}, onGetDirectorySuccess, onGetDirectoryFail); 
					findDirectory.getFile("/data/data/com.awaa.domlauncher/quickapps.xml", {create:true, exclusive: true}, onGetDirectorySuccess, onGetDirectoryFail); 
					findDirectory.getFile("/data/data/com.awaa.domlauncher/quickweb.xml", {create:true, exclusive: true}, onGetDirectorySuccess, onGetDirectoryFail);  
					findDirectory.getDirectory("/data/data/com.awaa.domlauncher/icons", {create: true, exclusive:true}, onGetIconDirectorySuccess, onGetDirectoryFail);
					findDirectory.getDirectory("/data/data/com.awaa.domlauncher/theme", {create: true, exclusive:true}, onGetDirectorySuccess, onGetDirectoryFail);						
					findDirectory.getFile("/data/data/com.awaa.domlauncher/triggersettings.txt", {create: true}, onGetSettingsDirectorySuccess, onGetSettingsDirectoryFail);	
					} 
			
				function onGetDirectorySuccess(file) { //Folder Exists. Call cdirInternal to check internal folder structure.
					  console.log("created "+file.name); 		
				} 
				
				function onGetIconDirectorySuccess(file) { //Folder Exists. Call cdirInternal to check internal folder structure.
					  console.log("created"+file.name); 	
						 refreshIcons();
				}
				
				function onGetSettingsDirectorySuccess(file) { //Folder Exists. Call cdirInternal to check internal folder structure.
					 file.remove(); //Deletes the File
					 console.log("deleting triggersettings");
				}
				function onGetSettingsDirectoryFail(file) { //Folder Exists. Call cdirInternal to check internal folder structure.
					  file.remove(); //Deletes the File
				}
				function onGetDirectoryFail(error) { //Folder doesn't exist. Call cdirBase to create.
					 console.log("does not exist or already exists"); 
				}
			
				$.ajax({ //Loads the downloaded xml file into the applications. 
				type: "GET",
				url: "file:///mnt/sdcard/DOMLauncher/themeList.xml", //File path of the xml.
				dataType: "xml",
				success: function(xml){
				$(xml).find('THEME').each(function(){	//Retreives the data from each xml Node.
					var tmName = $(this).find('NAME').text();
					var tmPath = $(this).find('PATH').text();
					 $('#loadTheme').append('<input type="button" class="btn_themeLoad" value="'+tmPath+'"/>');
					});
				  },
				  error: function() {
				  }
			  });
			}	
					

				
				
				
			

			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			$(document).on('click', '.btn_themeLoad', function(){
				
				var path = $(this).attr('value');
				copyTheme(path);
			});

			function copyTheme(path){									
				window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, folderCopy, null); 
			//alert(path);
				function folderCopy(fileSystem) { 
					fileSystem.root.getDirectory("/data/data/com.awaa.domlauncher/theme", {create: true, exclusive:false}, dirDel, null);
					fileSystem.root.getDirectory(path, {create: false, exclusive:false}, dirSuc, dirFail);
				
				} 
			
				function dirDel(dir) { //Folder doesn't exist. Call cdirBase to create.
					 console.log("Theme folder Recreated: " + dir); 
				} 					
			
				function dirSuc(dir) { //Folder Exists. Call cdirInternal to check internal folder structure.
					
					   var parentEntry = new DirectoryEntry('com.awaa.domlauncher', '/data/data/com.awaa.domlauncher');
						console.log(parentEntry);
						
						dir.copyTo(parentEntry, 'theme' ,success, fail);
					  
						function success(entry) {
							console.log("Copy Worked");
							alert('worked');
						}
						
						function fail(error) {
							alert('failed');
							console.log(error.code);
							
						}
					  console.log("domlauncher SD Ok "); 
				} 
			
				function dirFail(error) { //Folder doesn't exist. Call cdirBase to create.
					 console.log("SD domlauncher No"); 
				} 					
							
			}

			
        



        </script>
   
    </head>
    
    <body onLoad="onLoad()">
        <div class="header" style="height:20%; width:100%;">
   </div>
        <span> DOMLauncher  </span>
        <div class="box" id="loadTheme">
        	<h1>Load Theme</h1>
            <p>The folders are held in the CHomeRepo folder on the sd card. Tap a UI Plugin to load the theme (will restart CHome).</p>
            
            
        </div>     
        <div class="box">
        	<h1>Icon Cache</h1>
            <p>Installed applications are saved to the internal data folder.  Users can manually refresh this cache<!-- or back up their icons to the SD card-->.</p>
            <input type="button" value="Rebuild Cache" onClick="refreshIcons()"/>
            <!--<input type="button" value="Backup Icons" />-->
        </div>     
<!--        <div class="box">
        	<h1>Backup/Import Data</h1>
            <p>To help users CHome features a universal repository outside the UI Plugins to maintain the Quick Contacts, Web Pages and Applications.  These are specific functions.  
            If a UI Plugin Developer does not use this API, the information can not be saved via this panel. The saved file will be an XML file.  A user can manually modify
            this file (or create their own) and import the files. Place the XML files into the CHomeRepo directory, appropriately named 'quickContacts.xml/favApps.xml/webPages.xml'.</p>
            <input type="button" value="Save Quick Contacts" />
            <input type="button" value="Save Favorite Apps" />
            <input type="button" value="Save Web Pages" />
            <hr>
            <input type="button" value="Import Quick Contacts" />
            <input type="button" value="Import Favorite Apps" />
            <input type="button" value="Import Web Pages" />
        </div>    
-->        
        
        
            </body>

</html>
